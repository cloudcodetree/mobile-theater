# D-1.1: ESP32 Dev Environment Setup

| Field | Value |
|-------|-------|
| **Phase** | 1 - Wireless PoC |
| **Status** | ⬜ Not Started |
| **Cost** | $20 |
| **Assignee** | — |

## Description

Set up the ESP32 development environment, flash test firmware to two ESP32-S3 boards, and verify basic ESP-NOW communication between them.

## Acceptance Criteria

- [ ] Development environment installed (ESP-IDF or Arduino)
- [ ] Both ESP32-S3 boards flash successfully
- [ ] Serial monitor shows output from both boards
- [ ] Basic ESP-NOW ping/pong test passes
- [ ] Round-trip latency measured

## Bill of Materials

| Item | Qty | Unit Price | Total | Source | Status |
|------|-----|------------|-------|--------|--------|
| ESP32-S3-DevKitC-1 | 2 | $10.00 | $20.00 | [Amazon](https://amazon.com) | ⬜ |

**Deliverable Total:** $20.00

## Tasks

- [ ] Choose framework (ESP-IDF vs Arduino)
- [ ] Install toolchain and IDE
- [ ] Connect first ESP32-S3, verify USB detection
- [ ] Flash "Hello World" / blink test
- [ ] Repeat for second ESP32-S3
- [ ] Get MAC addresses from both boards
- [ ] Flash ESP-NOW TX code to board 1
- [ ] Flash ESP-NOW RX code to board 2
- [ ] Verify bidirectional communication
- [ ] Measure and document latency

## Technical Notes

### Framework Decision

| Framework | Pros | Cons |
|-----------|------|------|
| **ESP-IDF** | Full control, better performance, official | Steeper learning curve |
| **Arduino** | Familiar, faster prototyping | Less control, potential overhead |

**Recommendation:** Start with Arduino for rapid prototyping, migrate to ESP-IDF if performance issues arise.

### Getting MAC Address

```cpp
#include <WiFi.h>

void setup() {
  Serial.begin(115200);
  Serial.println(WiFi.macAddress());
}

void loop() {}
```

### Basic ESP-NOW TX

```cpp
#include <esp_now.h>
#include <WiFi.h>

uint8_t receiverMAC[] = {0xXX, 0xXX, 0xXX, 0xXX, 0xXX, 0xXX};

void setup() {
  Serial.begin(115200);
  WiFi.mode(WIFI_STA);
  
  if (esp_now_init() != ESP_OK) {
    Serial.println("ESP-NOW init failed");
    return;
  }
  
  esp_now_peer_info_t peerInfo = {};
  memcpy(peerInfo.peer_addr, receiverMAC, 6);
  peerInfo.channel = 0;
  peerInfo.encrypt = false;
  
  esp_now_add_peer(&peerInfo);
}

void loop() {
  char msg[] = "ping";
  esp_now_send(receiverMAC, (uint8_t *)msg, sizeof(msg));
  delay(1000);
}
```

### Basic ESP-NOW RX

```cpp
#include <esp_now.h>
#include <WiFi.h>

void onReceive(const uint8_t *mac, const uint8_t *data, int len) {
  Serial.printf("Received: %s\n", (char*)data);
}

void setup() {
  Serial.begin(115200);
  WiFi.mode(WIFI_STA);
  esp_now_init();
  esp_now_register_recv_cb(onReceive);
}

void loop() {}
```

## Test Procedure

1. Flash TX firmware to Board 1
2. Flash RX firmware to Board 2
3. Open serial monitors for both
4. Verify RX prints "Received: ping" every second
5. Add timestamp to measure latency
6. Record 100 samples, calculate average

## Expected Results

| Metric | Target | Actual |
|--------|--------|--------|
| TX flashes successfully | Yes | — |
| RX flashes successfully | Yes | — |
| ESP-NOW link established | Yes | — |
| Messages received | 100% | — |
| Avg latency | <5ms | — |

## References

- [ESP-NOW Getting Started](https://randomnerdtutorials.com/esp-now-esp32-arduino-ide/)
- [ESP32-S3 DevKitC Pinout](https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/hw-reference/esp32s3/user-guide-devkitc-1.html)

## Work Log

### YYYY-MM-DD
- Started deliverable
