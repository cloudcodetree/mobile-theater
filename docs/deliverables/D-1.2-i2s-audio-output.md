# D-1.2: I2S Audio Output Test

**Phase:** 1 â€” Wireless Proof of Concept  
**Estimated Cost:** $10  
**Status:** â¬œ Not Started  
**Dependencies:** D-1.1  

---

## Overview

Connect a PCM5102A DAC to the receiver ESP32 and verify audio output through I2S.

---

## Acceptance Criteria

- [ ] DAC wired correctly to ESP32-S3
- [ ] I2S configured (48kHz, 16-bit, stereo)
- [ ] Test tone plays cleanly through headphones/speaker
- [ ] No audible noise or distortion
- [ ] Volume control functional (if implemented)

---

## Bill of Materials

| Item | Qty | Unit Price | Total | Source | Status |
|------|-----|------------|-------|--------|--------|
| PCM5102A DAC Breakout | 1 | $5.00 | $5.00 | Amazon / AliExpress | â¬œ |
| 3.5mm Audio Cable | 1 | $3.00 | $3.00 | Amazon | â¬œ |
| Breadboard | 1 | $2.00 | $2.00 | Amazon | â¬œ |
| **Total** | | | **$10.00** | | |

---

## Tasks

- [ ] Wire PCM5102A to ESP32-S3 (see pinout below)
- [ ] Configure I2S peripheral in firmware
- [ ] Generate sine wave test tone (1kHz)
- [ ] Play through headphones/speaker
- [ ] Verify audio quality
- [ ] Test different sample rates (44.1kHz, 48kHz, 96kHz)
- [ ] Document results

---

## Technical Notes

### Wiring (ESP32-S3 to PCM5102A)

```
ESP32-S3          PCM5102A
â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€
3V3        â”€â”€â”€â”€â–º  VCC
GND        â”€â”€â”€â”€â–º  GND
GPIO 4     â”€â”€â”€â”€â–º  BCK (Bit Clock)
GPIO 5     â”€â”€â”€â”€â–º  LCK/WS (Word Select)
GPIO 6     â”€â”€â”€â”€â–º  DIN (Data In)
           
GND        â”€â”€â”€â”€â–º  SCK (tie to GND for internal clock)
GND        â”€â”€â”€â”€â–º  FMT (tie to GND for I2S standard)
3V3        â”€â”€â”€â”€â–º  XSMT (tie to 3V3 to unmute)
```

### Wiring Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESP32-S3   â”‚                  â”‚  PCM5102A   â”‚
â”‚             â”‚                  â”‚             â”‚
â”‚        3V3  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  VCC        â”‚
â”‚        GND  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  GND        â”‚
â”‚             â”‚                  â”‚             â”‚
â”‚      GPIO4  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  BCK        â”‚
â”‚      GPIO5  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  LCK        â”‚
â”‚      GPIO6  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  DIN        â”‚
â”‚             â”‚                  â”‚             â”‚
â”‚        GND  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  SCK        â”‚
â”‚        GND  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  FMT        â”‚
â”‚        3V3  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  XSMT       â”‚
â”‚             â”‚                  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚        OUT â”€â”¼â”€â”€â–º ğŸ§ Headphones
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### I2S Configuration (ESP-IDF)

```c
#include "driver/i2s_std.h"

i2s_chan_handle_t tx_handle;

i2s_chan_config_t chan_cfg = I2S_CHANNEL_DEFAULT_CONFIG(I2S_NUM_0, I2S_ROLE_MASTER);
i2s_new_channel(&chan_cfg, &tx_handle, NULL);

i2s_std_config_t std_cfg = {
    .clk_cfg = I2S_STD_CLK_DEFAULT_CONFIG(48000),
    .slot_cfg = I2S_STD_PHILIPS_SLOT_DEFAULT_CONFIG(I2S_DATA_BIT_WIDTH_16BIT, I2S_SLOT_MODE_STEREO),
    .gpio_cfg = {
        .mclk = I2S_GPIO_UNUSED,
        .bclk = GPIO_NUM_4,
        .ws = GPIO_NUM_5,
        .dout = GPIO_NUM_6,
        .din = I2S_GPIO_UNUSED,
    },
};
i2s_channel_init_std_mode(tx_handle, &std_cfg);
i2s_channel_enable(tx_handle);
```

### Test Tone Generation

```c
#include <math.h>

#define SAMPLE_RATE 48000
#define TONE_FREQ 1000
#define AMPLITUDE 16000

int16_t samples[256];
for (int i = 0; i < 256; i++) {
    float t = (float)i / SAMPLE_RATE;
    int16_t sample = (int16_t)(AMPLITUDE * sinf(2.0f * M_PI * TONE_FREQ * t));
    samples[i * 2] = sample;      // Left
    samples[i * 2 + 1] = sample;  // Right
}

size_t bytes_written;
i2s_channel_write(tx_handle, samples, sizeof(samples), &bytes_written, portMAX_DELAY);
```

---

## Test Procedure

1. Power off ESP32
2. Wire DAC according to pinout above
3. Double-check connections with multimeter (continuity)
4. Flash I2S test firmware
5. Connect headphones to DAC 3.5mm jack
6. Power on ESP32
7. Listen for clean 1kHz tone
8. Check for noise, clicks, or distortion

---

## Expected Results

| Metric | Target | Actual |
|--------|--------|--------|
| Audio plays | Yes | â€” |
| Noise floor | Inaudible | â€” |
| Distortion | None | â€” |
| Sample rate | 48kHz | â€” |

---

## Troubleshooting

| Symptom | Likely Cause | Fix |
|---------|--------------|-----|
| No audio | XSMT not high | Tie XSMT to 3V3 |
| Crackling | Wrong BCK/LCK | Swap GPIO 4 and 5 |
| High pitch | Wrong sample rate | Check I2S config |
| Mono only | Slot config | Use I2S_SLOT_MODE_STEREO |

---

## References

- [PCM5102A Datasheet](https://www.ti.com/lit/ds/symlink/pcm5102a.pdf)
- [ESP-IDF I2S API](https://docs.espressif.com/projects/esp-idf/en/latest/esp32s3/api-reference/peripherals/i2s.html)
- [ESP32 Audio Development Guide](https://github.com/atomic14/esp32-audio)

---

## Work Log

### YYYY-MM-DD
- (Add progress notes here)
